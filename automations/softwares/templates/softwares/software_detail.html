{% extends 'base.html' %}
{% block main %}

<div class="uk-container" id="data-container"></div>

<center id="spinner">
    <div uk-spinner="ratio: 3"></div>
</center>
{{software|json_script:"software-data"}}

<script>

    var root = document.querySelector("#data-container")
    var software = JSON.parse(document.querySelector("#software-data").innerText)
    
    var title = document.createElement("h1")
    root.appendChild(title)
    title.innerText = software.repositoryname

    function renderRelease(release){

        document.querySelector("#spinner").style.display = "none"

        var container = document.createElement("div")
        container.classList.add("uk-card")
        container.classList.add("uk-card-default")
        container.classList.add("uk-card-hover")
        container.classList.add("uk-card-body")
        root.appendChild(container)

        var seperator = document.createElement("br")
        root.appendChild(seperator)

        var heading = document.createElement("h3")
        heading.classList.add("uk-card-title")
        container.appendChild(heading)

        var body = document.createElement("p")
        container.appendChild(body)

        //Adding content
        heading.innerText = release.tag_name
        body.innerHTML = marked.parse(release.body)

        release.assets.forEach((asset)=>{
            var a = document.createElement("a")
            a.classList.add("uk-button")
            a.classList.add("uk-button-primary")
            a.setAttribute("href",asset.browser_download_url)

            a.innerText = asset.name + " " + release.tag_name

            container.appendChild(a)
        })
    }

    function renderError(error){
        document.querySelector("#spinner").style.display = "none"
        alert(error)
    }

    fetch(`https://api.github.com/repos/${software.repositoryowner}/${software.repositoryname}/releases`).then(response => response.json()).then((data)=>{
        data.forEach((item)=>{
            renderRelease(item)
        })
    }).catch((error)=>{
        renderError(error)
    })
</script>

{% endblock main %}